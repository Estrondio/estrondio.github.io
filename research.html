<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background-color: black;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        #startButton, #trialSymbol, #trialCounter, #rewardDisplay, #timer {
            font-size: 2em;
            margin-bottom: 20px;
        }

        #trialSymbol {
            font-weight: bold;
            font-size: 3em;
            cursor: pointer; /* Add cursor pointer for interaction */
        }

        #timer {
            font-size: 2.5em;
            color: #00ff00; /* Green color for the timer */
        }

        #rewardDisplay {
            font-size: 1.5em;
        }
    </style>
    <script>
        let trialCount = 0;
        let reward = 0;
        let timer;

        function startExperiment() {
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('trialCounter').innerText = 'Trial ' + (trialCount + 1);
            document.getElementById('timer').innerText = '5';

            // Call your Python backend logic here for each trial
            simulateTrial();
        }

        function simulateTrial() {
            // Reset timer
            clearInterval(timer);

            // Simulate the environment and update trial display
            // Replace this with your actual environment logic

            // For now, let's just randomly assign GO, NOGO, or CHECK
            const tubeStates = ["GO", "NOGO", "CHECK"];
            const randomIndex = Math.floor(Math.random() * tubeStates.length);
            const tubeState = tubeStates[randomIndex];

            displayTrialSymbol(tubeState);
        }

        function displayTrialSymbol(tubeState) {
            const trialSymbol = document.getElementById('trialSymbol');
            trialSymbol.innerText = tubeState === "GO" ? "#" : tubeState === "NOGO" ? "*" : "";
            trialSymbol.onclick = function() {
                clearInterval(timer);
                nextTrial();
            };

            // Start the countdown timer
            let countdown = 5;
            timer = setInterval(() => {
                document.getElementById('timer').innerText = countdown;
                countdown--;

                if (countdown < 0) {
                    clearInterval(timer);
                    endTrial(tubeState);
                }
            }, 1000);
        }

        function endTrial(tubeState) {
            // Simulate user action (replace this with your logic)
            const userAction = Math.random() < 0.5 ? "Lick" : "Wait";

            // Calculate reward based on user action and tube state
            if (userAction === "Lick") {
                if (tubeState === "GO") {
                    reward += 1;
                    document.getElementById('rewardDisplay').innerText = '+1 reward';
                } else if (tubeState === "NOGO") {
                    reward -= 1;
                    document.getElementById('rewardDisplay').innerText = '-1 reward';
                } else {
                    document.getElementById('rewardDisplay').innerText = '+0 reward';
                }
            } else {
                document.getElementById('rewardDisplay').innerText = '+0 reward';
            }

            // Display reward
            document.getElementById('rewardDisplay').innerText = 'Reward: ' + reward;

            // Move to the next trial after a delay (1 second)
            setTimeout(nextTrial, 1000);
        }

        function nextTrial() {
            trialCount++;
            if (trialCount < 15) {
                document.getElementById('trialCounter').innerText = 'Trial ' + (trialCount + 1);
                simulateTrial();
            } else {
                endExperiment();
            }
        }

        function endExperiment() {
            // Display final score
            document.getElementById('trialCounter').innerText = 'Final Score';
            document.getElementById('trialSymbol').innerText = '';
            document.getElementById('rewardDisplay').innerText = 'Total Reward: ' + reward;
            document.getElementById('timer').innerText = '';
        }
    </script>
</head>
<body>
    <button id="startButton" onclick="startExperiment()">START</button>
    <div id="trialSymbol"></div>
    <div id="trialCounter"></div>
    <div id="rewardDisplay"></div>
    <div id="timer"></div>
</body>
</html>
