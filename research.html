<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background-color: green; /* Change background color to green */
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 60vh; /* Smaller window for easy integration */
            margin: 0;
        }

        #startButton {
            font-size: 1.5em; /* Adjust font size for smaller window */
        }

        #trialSymbol {
            font-weight: bold;
            font-size: 3em;
            cursor: pointer; /* Add cursor pointer for interaction */
            display: inline-block; /* Align with the buttons */
            margin-bottom: 10px; /* Adjust margin for better spacing */
        }

        .actionButton {
            font-size: 1.5em; /* Adjust font size for smaller window */
            margin: 0 10px; /* Add margin between buttons */
            padding: 8px 16px; /* Add padding to buttons */
            cursor: pointer;
            transition: box-shadow 0.3s ease; /* Add shadow transition on hover */
        }

        .actionButton:hover {
            box-shadow: 0 0 10px rgba(0, 0, 255, 0.8); /* Add shadow on hover */
        }

        #timer {
            font-size: 2.5em;
            color: #00ff00; /* Green color for the timer */
        }

        #rewardDisplay {
            font-size: 1.5em;
        }
    </style>
    <script>
        let trialCount = 0;
        let reward = 0;
        let timer;

        function startExperiment() {
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('trialCounter').innerText = 'Trial ' + (trialCount + 1);
            document.getElementById('timer').innerText = '5';

            // Call your Python backend logic here for each trial
            simulateTrial();
        }

        function simulateTrial() {
            // Reset timer
            clearInterval(timer);

            // Simulate the environment and update trial display
            // Replace this with your actual environment logic

            // For now, let's just randomly assign GO, NOGO, or CHECK
            const tubeStates = ["GO", "NOGO", "CHECK"];
            const randomIndex = Math.floor(Math.random() * tubeStates.length);
            const tubeState = tubeStates[randomIndex];

            displayTrialSymbol(tubeState);
        }

        function displayTrialSymbol(tubeState) {
            const trialSymbol = document.getElementById('trialSymbol');
            trialSymbol.innerText = tubeState === "GO" ? "" : tubeState === "NOGO" ? "" : "";
            trialSymbol.onclick = function() {
                clearInterval(timer);
                nextTrial();
            };

            // Start the countdown timer
            let countdown = 5;
            timer = setInterval(() => {
                document.getElementById('timer').innerText = countdown;
                countdown--;

                if (countdown < 0) {
                    clearInterval(timer);
                    endTrial(tubeState);
                }
            }, 1000);
        }

        function endTrial(tubeState) {
            // Simulate user action (replace this with your logic)
            const userAction = Math.random() < 0.5 ? "Lick" : "Wait";

            // Calculate reward based on user action and tube state
            if (userAction === "Lick") {
                if (tubeState === "GO") {
                    reward += 1;
                    document.getElementById('rewardDisplay').innerText = '+1 reward';
                } else if (tubeState === "NOGO") {
                    reward -= 1;
                    document.getElementById('rewardDisplay').innerText = '-1 reward';
                } else {
                    document.getElementById('rewardDisplay').innerText = '+0 reward';
                }
            } else {
                document.getElementById('rewardDisplay').innerText = '+0 reward';
            }

            // Display reward
            document.getElementById('rewardDisplay').innerText = 'Reward: ' + reward;

            // Show results screen for 2 seconds
            setTimeout(() => {
                document.getElementById('trialSymbol').innerText = '';
                document.getElementById('rewardDisplay').innerText = '';
                nextTrial();
            }, 2000);
        }

        function nextTrial() {
            trialCount++;
            if (trialCount < 15) {
                document.getElementById('trialCounter').innerText = 'Trial ' + (trialCount + 1);
                simulateTrial();
            } else {
                endExperiment();
            }
        }

        function endExperiment() {
            // Display final score
            document.getElementById('trialCounter').innerText = 'Final Score';
            document.getElementById('timer').innerText = '';
            document.getElementById('trialSymbol').innerText = '';
            document.getElementById('rewardDisplay').innerText = 'Total Reward: ' + reward;
        }
    </script>
</head>
<body>
    <button id="startButton" onclick="startExperiment()">START</button>
    <div id="trialSymbol"></div>
    <div>
        <button class="actionButton" style="background-color: blue; color: white;" onclick="endTrial('GO')">Blue</button>
        <button class="actionButton" style="background-color: yellow; color: black;" onclick="endTrial('NOGO')">Yellow</button>
    </div>
    <div id="trialCounter"></div>
    <div id="rewardDisplay"></div> 
    <div id="timer"></div>
</body>
</html>
